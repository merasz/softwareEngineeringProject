<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3c.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/templates/main.xhtml">
    <ui:define name="content">

        <h:form enctype="multipart/form-data" style="width: 50%; margin-top: 10px; float: right;">
            <p:fileUpload value="#{topicParserController.file}" mode="simple" skinSimple="true" style="color: white"/>
            <p:commandButton value="Submit" ajax="false" action="#{topicParserController.upload}"
                             styleClass="p-mt-3 ui-button-outlined p-d-block"/>
        </h:form>
        <h:form id="topicForm">
            <p:commandButton style="width: 10%; margin-top: 9px;margin-right: 9px; float: right;" id="help"
                             oncomplete="PF('helpDialog').show()" icon="ui-icon-info" value="Help" title="Help"/>
            <p:dialog header="Info" id="helpDialog" widgetVar="helpDialog" width="400">
                <h:panelGrid columns="1">
                    <h2 style="color: #0d9dbb; font-weight: bold; margin-top: 2px">Choose File</h2>
                    <h:outputText value="Click the 'choose' button to add a json File and submit. The JSON-file should contain 1 or more Topics and associated Terms."/>
                    <h2 style="color: #0d9dbb; font-weight: bold;">Create new Topic</h2>
                    <h:outputText value="Click to add a new Topic."/>
                    <h2 style="color: #0d9dbb; font-weight: bold; display: inline-block">Add Term</h2>
                    <h:outputText value="Click to add a new Term."/>
                    <h2 style="color: #0d9dbb; font-weight: bold;">Delete Topic</h2>
                    <h:outputText
                            value="Click to the button to delete the Topic. For now the topic deletion is not available because, if you want delete a topic, the user statistics w'ont be right."/>
                </h:panelGrid>
            </p:dialog>

            <p:dataTable widgetVar="topicCreationTable" id="topicCreationTable" var="topic"
                         value="#{topicListController.topicAmount}" style="width: 83%; margin-top: 85px; float: right;">
                <f:facet name="header">Topic Hub</f:facet>
                <p:column headerText="Themengebiet">
                    <h:outputText value="#{topic.topic.topicName}"/>
                </p:column>
                <p:column headerText="Anzahl Begriffe">
                    <h:outputText value="#{topic.gameCount}"/>
                </p:column>

                <p:column style="width:100px;text-align: center" headerText="create">
                    <p:commandButton title="Terms" icon="ui-icon-note"
                                     action="#{termListController.doSetTopic(topicController.gameTopicCount.topic)}"
                                     update=":termsForm" oncomplete="$('#topicForm').hide();$('#termsForm').show();"
                                     style="width:20px;height:20px">
                        <f:setPropertyActionListener value="#{topic}" target="#{topicController.gameTopicCount}"/>
                    </p:commandButton>
                </p:column>
                <p:column style="width:100px;text-align: center" headerText="delete">
                    <p:commandButton action="#{topicController.doDeleteTopic}" icon="ui-icon-trash" title="Delete"
                                     update=":topicForm:topicCreationTable">
                        <f:setPropertyActionListener value="#{topic.topic}" target="#{topicController.topic}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
            <p:commandButton style="width: 25%; margin-top: 25px; float: right;"
                             oncomplete="PF('topicCreationDialog').show()" icon="ui-icon-add-box"
                             action="#{topicController.doCreateNewTopic()}" value="Create new Topic">
                <f:setPropertyActionListener value="#{topic}" target="#{topicController.topic}"/>
            </p:commandButton>
        </h:form>

        <h:form id="createTopicForm">
            <p:dialog header="Create new Topic" id="topicCreationDialog" widgetVar="topicCreationDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="topicCreateData">
                    <h:panelGrid columns="2">
                        <p:outputLabel for="topicName" value="Topic Name: "/>
                        <p:inputText id="topicName" value="#{topicController.topic.topicName}"/>
                    </h:panelGrid>
                    <h:panelGrid columns="2">
                        <p:commandButton value="Save" action="#{topicController.doSaveTopic()}"
                                         oncomplete="PF('topicCreationDialog').hide()"
                                         update=":topicForm:topicCreationTable :createTopicForm"/>
                        <p:commandButton value="Abort" onclick="PF('Dialog').hide()"/>
                    </h:panelGrid>
                </p:outputPanel>
            </p:dialog>
        </h:form>

        <h:form id="termsForm" style="display: none" enctype="multipart/form-data">
            <p:dataTable widgetVar="termsTable" id="termsTable" var="term" value="#{termListController.termsByTopic}"
                         style="width: 83%; margin-top: 110px; float: right;">
                <f:facet name="header">Creat new Term for Selected Topic</f:facet>
                <p:column headerText="Term name">
                    <h:outputText value="#{term.termName}"/>
                </p:column>
                <p:column style="width:100px;text-align: center" headerText="delete">
                    <p:commandButton action="#{termsController.deleteTerm}" icon="ui-icon-trash" title="Delete"
                                     update=":termsForm:termsTable">
                        <f:setPropertyActionListener value="#{term}" target="#{termsController.term}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
            <p:commandButton style="width: 25%; margin-top: 25px; float: right;"
                             oncomplete="PF('termCreationDialog').show()" icon="ui-icon-add-box"
                             action="#{termsController.doCreateNewTerm()}" value="Create new Term" update=":termsForm:termCreationDialog">
                <f:setPropertyActionListener value="#{term}" target="#{termsController.term}"/>
            </p:commandButton>
            <p:commandButton style="width: 200px; margin-top: 25px; float: left; margin-left: 290px" oncomplete="$('#termsForm').hide();$('#topicForm').show();"
                             update=":topicForm:topicCreationTable"
                             icon="ui-icon-arrowthick-1-w" value ="Back to Topics">
            </p:commandButton>

            <p:dialog header="Create new Term" id="termCreationDialog" widgetVar="termCreationDialog" modal="true"
                      showEffect="fade" hideEffect="fade" resizable="false">
                <p:outputPanel id="termCreateData" >
                    <h:panelGrid columns="2">
                        <p:outputLabel for="termName" value="Term Name: "/>
                        <p:inputText id="termName" value="#{termsController.term.termName}"/>
                    </h:panelGrid>

                    <p:separator/>

                    <h:panelGrid columns="2">
                        <p:commandButton value="Save"
                                         action="#{termsController.doSaveTerm(topicController.gameTopicCount.topic)}"
                                         oncomplete="PF('termCreationDialog').hide()" update=":termsForm:termsTable"/>
                        <p:commandButton value="Abort" onclick="PF('Dialog').hide();$('#termsForm').show();"/>
                    </h:panelGrid>

                </p:outputPanel>
            </p:dialog>
        </h:form>

    </ui:define>
</ui:composition>