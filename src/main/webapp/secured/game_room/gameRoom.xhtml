<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3c.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:ng="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:demo="http://java.sun.com/jsf/composite/demo"
                template="/WEB-INF/templates/main.xhtml">

    <h:head>
        <title>Gruppe6Team1 - Start</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <link rel="stylesheet" href="/resources/css/style.css"/>
    </h:head>
    <h:body>
        <h:panelGroup layout="block" style="display: flex; flex-direction: column;align-items: center; justify-content: space-around; min-height: 100vh">
            <h:panelGroup layout="block" style="font-size: 54px; font-weight: bold; color: #ffffff; display: flex; flex-direction: column; align-items: center">
                <h:outputText style="text-shadow: 2px 7px 5px rgba(0,0,0,0.3),
    0px -4px 10px rgba(255,255,255,0.3);" value="#{sessionInfoBean.currentGame.gameName}" />
                <h:outputText style="font-size:34px; margin-top: 20px" value="#{teamController.getTeamByPlayerAndGame(sessionInfoBean.currentUser,sessionInfoBean.currentGame).teamName}" />
            </h:panelGroup>

            <h:form style="width: 90%" id="gameForm">
                <h:panelGroup layout="block" style="display: flex; flex-direction: column; box-sizing:border-box; width: 100%;background: #ffffff; align-items: center; padding: 20px; border-radius: 5px;  box-shadow: rgba(0, 0, 0, 0.25) 0px 54px 55px, rgba(0, 0, 0, 0.12) 0px -12px 30px, rgba(0, 0, 0, 0.12) 0px 4px 6px, rgba(0, 0, 0, 0.17) 0px 12px 13px, rgba(0, 0, 0, 0.09) 0px -3px 5px;">
                        <h:outputText value="Term: " style=" font-size: 32px; "/>
                        <h:outputText value="#{gamePlaySocketController.getNextTerm(sessionInfoBean.currentGame)}" id="termField" styleClass="term" style="font-size: 32px; font-weight: bold; margin-bottom: 25px"/>

                        <h:outputText value="Player: " style=" font-size: 32px;"/>
                        <h:outputText value="#{gamePlaySocketController.getNextPlayer(sessionInfoBean.currentGame)} " id="playerField" style="font-size: 26px; font-weight: bold; margin-bottom: 20px"/>
                        <h:outputText value="#{gamePlaySocketController.getType(sessionInfoBean.currentGame)}" id="typeField" style=" font-size: 26px; font-weight: bold; margin-bottom: 10px"/>

                        <h:outputText value="#{gamePlaySocketController.getPoints(sessionInfoBean.currentGame)} Point(s)" id="pointsField" style="font-size: 26px; font-weight: bold; "/>
                </h:panelGroup>
                <o:socket channel="termChannel" user="#{sessionInfoBean.currentUserName}" onmessage="function(m){console.log(m);}">
                    <f:ajax event="termUpdate" render="termField typeField pointsField playerField" onevent="updateOtherScreen()" />
                    <f:ajax event="termUpdateCurrent" render="typeField pointsField playerField" onevent="updatePlayerScreen()" />
                </o:socket>

            </h:form>


            <h:form id="scoreBoard" style="width: 90%">
                <p:growl id="scoreData" showDetail="false" life="6000">
                    <p:autoUpdate/>
                </p:growl>
                <h:panelGroup layout="block" style="display: flex; flex-direction: column;align-items: center">
                    <h:panelGroup layout="block" style="display: flex; width: 100%; justify-content: space-between; margin-bottom: 35px">
                        <p:commandButton id="termYesBtn" widgetVar="yesBtn" value="Guessed Correctly" styleClass="gameButton" style="background:#009a00"
                                         action="#{gamePlaySocketController.termGuessed(sessionInfoBean.currentGame)}" >
                        </p:commandButton>

                        <p:commandButton id="ruleBreakerBtn" widgetVar="ruleBtn" value="Rulebreak" styleClass="gameButton" style="background:#e67200"
                                         action="#{gamePlaySocketController.termGuessedWithRulebreak(sessionInfoBean.currentGame)}" >
                        </p:commandButton>

                        <p:commandButton id="termNoBtn" widgetVar="noBtn" value="Not Guessed Correctly" styleClass="gameButton" style="background:#9a0000"
                                         action="#{gamePlaySocketController.termNotGuessed(sessionInfoBean.currentGame)}" >
                        </p:commandButton>


                    </h:panelGroup>
                    <p:dataTable widgetVar="scoreTable" id="scoreTable" var="score"
                                 value="#{scoreManagerController.getScores(sessionInfoBean.currentGame)}" >
                        <f:facet name="header">Scores</f:facet>
                        <p:column headerText="Team">
                            <h:outputText value="#{score.team.teamName}"/>
                        </p:column>
                        <p:column headerText="Score">
                            <h:outputText value="#{score.score}"/>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>


                <o:socket channel="scoreChannel" user="#{sessionInfoBean.currentUserName}" onmessage="function(m){console.log(m);}">
                    <f:ajax event="scoreUpdate" render="scoreTable"/>
                </o:socket>
            </h:form>
            <h:form>
                <h:panelGroup layout="block" style="" id="timerOuter">
                    <pe:timer
                        id="timer1"
                        widgetVar="timer1"
                        visible="false"
                        singleRun="true"
                        listener="#{gamePlaySocketController.onTimerOver(sessionInfoBean.currentGame)}"
                        ontimerstep="sync(intervalData)"
                        timeout="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"/>
                    <p:knob
                            min="0"
                            max="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"
                            widgetVar="knob"
                            disabled="true"
                            value="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"/>
                </h:panelGroup>

                <o:socket channel="timeChannel" user="#{sessionInfoBean.currentUserName}" onmessage="function(m){console.log(m);}">
                    <f:ajax event="timeUpdate" render="timerOuter" />
                    <f:ajax event="stopTimer" onevent="PF('timer1').pause()" />
                </o:socket>

            </h:form>
            <h:form>
                <h:panelGroup layout="block" style="" id="nextOuter">
                    <pe:timer
                            id="timer1"
                            widgetVar="timer1"
                            visible="false"
                            singleRun="true"
                            listener="#{gamePlaySocketController.onTimerOver(sessionInfoBean.currentGame)}"
                            ontimerstep="sync(intervalData)"
                            timeout="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"/>
                    <p:knob
                            min="0"
                            max="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"
                            widgetVar="knob"
                            disabled="true"
                            value="#{gamePlaySocketController.timeMap[sessionInfoBean.currentGame.gameId]}"/>
                </h:panelGroup>

                <o:socket channel="timeChannel" user="#{sessionInfoBean.currentUserName}" onmessage="function(m){console.log(m);}">
                    <f:ajax event="timeUpdate" render="timerOuter" />
                    <f:ajax event="stopTimer" onevent="PF('timer1').pause()" />
                </o:socket>

            </h:form>
        </h:panelGroup>
    </h:body>
    <script type="text/javascript">
        window.sync = function(t){
            PF('knob').setValue(t.current);
        }

        function updatePlayerScreen() {
            $('#gameForm .term').html("");
            PF('yesBtn').disable()
            PF('ruleBtn').disable();
            PF('noBtn').disable();
        }

        function updateOtherScreen() {
            PF('yesBtn').enable();
            PF('ruleBtn').enable();
            PF('noBtn').enable();
        }
    </script>
</html>